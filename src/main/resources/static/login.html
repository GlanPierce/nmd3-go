<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>登录 - 忍者棋局</title>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/login.css">
</head>

<body class="login-page">

    <!-- Background Lighting Effects -->
    <div class="bg-light-overlay">
        <div class="light-ray"></div>
        <div class="light-pulse"></div>
    </div>

    <div id="auth-overlay">
        <!-- Character Images on Left -->
        <div class="login-characters">
            <img src="assets/ziyuan_login.png" alt="紫鸢" class="char-ziyuan">

            <!-- Floating Leaves Animation -->
            <div class="floating-leaves">
                <div class="leaf"></div>
                <div class="leaf"></div>
                <div class="leaf"></div>
                <div class="leaf"></div>
                <div class="leaf"></div>
                <div class="leaf"></div>
                <div class="leaf"></div>
            </div>

            <img src="assets/weili_login.png" alt="威力" class="char-weili">
        </div>

        <!-- Login Box on Right -->
        <div class="login-right">
            <!-- Title Image -->
            <img src="assets/title.png" alt="忍者棋局" class="login-title-img">

            <div id="auth-box">
                <!-- Login Container -->
                <div id="login-container" class="auth-container">
                    <form id="auth-form" onsubmit="return false;">
                        <!-- Error Message Area (Top) -->
                        <p id="auth-status" class="error-msg"></p>

                        <div class="input-group">
                            <input type="text" id="username" placeholder="请输入用户名" required>
                        </div>
                        <div class="input-group">
                            <input type="password" id="password" placeholder="请输入密码" required>
                        </div>

                        <div class="button-group">
                            <img src="assets/login_button.png" alt="登录" class="action-btn" id="btn-login"
                                onclick="handleAuth('login')">
                        </div>

                        <div class="register-hint">
                            没有账号？ <span class="register-link" onclick="toggleAuthMode('register')">去注册</span>
                        </div>
                    </form>
                </div>

                <!-- Register Container (Initially Hidden/Offset) -->
                <div id="register-container" class="auth-container">
                    <form id="register-form" onsubmit="return false;">
                        <!-- Error Message Area (Top) -->
                        <p id="reg-status" class="error-msg"></p>

                        <div class="input-group">
                            <input type="text" id="reg-username" placeholder="用户名 (3-16位)" required>
                        </div>
                        <div class="input-group">
                            <input type="password" id="reg-password" placeholder="密码 (8位+)" required>
                        </div>
                        <div class="input-group">
                            <input type="password" id="reg-password-confirm" placeholder="请再次输入密码" required>
                        </div>

                        <div class="button-group">
                            <img src="assets/reg_button.png" alt="注册" class="action-btn" id="btn-register"
                                onclick="handleAuth('register')">
                        </div>

                        <div class="register-hint">
                            已有账号？ <span class="register-link" onclick="toggleAuthMode('login')">返回登录</span>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay">
    </div>

    <script src="js/entries/login.js?v=3"></script>
    <script>
        // Toggle Auth Mode (Slide Effect)
        function toggleAuthMode(mode) {
            const authBox = document.getElementById('auth-box');
            const status = document.getElementById('auth-status');
            const regStatus = document.getElementById('reg-status');

            // Clear status messages
            if (status) status.textContent = '';
            if (regStatus) regStatus.textContent = '';

            if (mode === 'register') {
                authBox.classList.add('show-register');
            } else {
                authBox.classList.remove('show-register');
            }
        }

        // Unified Auth Handler
        function handleAuth(action) {
            if (action === 'login') {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                const status = document.getElementById('auth-status');

                if (!username || !password) {
                    status.textContent = "请输入用户名和密码";
                    return;
                }
                login(username, password);
            } else {
                const username = document.getElementById('reg-username').value;
                const password = document.getElementById('reg-password').value;
                const passwordConfirm = document.getElementById('reg-password-confirm').value;
                const status = document.getElementById('reg-status');

                if (!username || !password || !passwordConfirm) {
                    status.textContent = "请填写完整信息";
                    return;
                }
                if (password !== passwordConfirm) {
                    status.textContent = "两次输入的密码不一致";
                    return;
                }
                register(username, password);
            }
        }
    </script>
</body>

</html>